Perfeito.
Com base em tudo que desenvolvemos juntos sobre o **projeto EntregaTudo**, segue um **documento de base de conhecimento t√©cnico completo**, organizado por **camadas (superficiais ‚Üí profundas)** e, dentro de cada camada, em **ordem alfab√©tica**.

---

# üìò Base de Conhecimento ‚Äî Projeto EntregaTudo

## üîπ Vis√£o Geral

O **EntregaTudo** √© um sistema de gest√£o e opera√ß√£o log√≠stica para **motoboys e entregadoras**, integrado √† plataforma **TeleTudo**.
Ele abrange:

* **BackEnd (Laravel/PHP)** para controle de entregas, cadastro e or√ßamentos.
* **App Mobile (Flutter)** para **motoboys**, com login, heartbeat, atualiza√ß√£o de saldo, configura√ß√µes e cadastro.

---

## üß© CAMADA 1 ‚Äî BACKEND

### **1.1 Arquitetura**

* Linguagem: **PHP 8+**
* Framework: **Laravel**
* API principal: `https://teletudo.com/api`
* Estrutura modular: controladores separados por fun√ß√£o (`cadboy`, `orcamento`, `heartbeat`, etc.)

---

### **1.2 Endpoints Principais**

| Endpoint                  | Fun√ß√£o                         | Observa√ß√µes                                                              |
| ------------------------- | ------------------------------ | ------------------------------------------------------------------------ |
| `/api/cadboy`             | Cadastra novo motoboy          | Recebe dados completos do formul√°rio, incluindo placa, CNH, PIX e erros. |
| `/api/heartbeat`          | Atualiza posi√ß√£o e status      | Usa `userid`, `lat`, `lon`, `idLoja`. Retorna status da entrega.         |
| `/api/saldo`              | Retorna saldo atual do motoboy | Utilizado no app via `API.saldo()`                                       |
| `/api/orcamento`          | Calcula or√ßamento da entrega   | Usa coordenadas cliente/fornecedor, modo de teste e dist√¢ncia simulada.  |
| `/api/saveConfigurations` | Salva configura√ß√µes do motoboy | Recebe kmRate, adicionais e dist√¢ncia m√°xima.                            |

---

### **1.3 Modelos de Dados**

#### **Motoboy (`tt_entregador` / `et_entregador`)**

* `id`
* `nome_completo`
* `usuario`
* `email`
* `telefone`
* `cnh`
* `placa`
* `pix`
* `distancia_maxima`
* `erroCodigo`
* `versaoApp`

#### **Entrega**

* `id_pedido`
* `id_entregador`
* `status` (`retirado`, `em rota`, `entregue`)
* `coordenadas_cliente`
* `coordenadas_loja`

---

### **1.4 Processos Internos**

* **Heartbeat:** Atualiza coordenadas e status em tempo real.
* **Cadastro:** Faz valida√ß√£o e grava motoboy com registro de erros poss√≠veis (`erroCodigo`: 0‚Äì3).
* **Or√ßamento:** Calcula custo com base em taxa base + km + adicionais (chuva, peso, madrugada etc.).
* **Autentica√ß√£o:** Usa e-mail/senha com verifica√ß√£o de duplicidade e resposta JSON.
* **Valida√ß√µes:** Implementadas no servidor e replicadas no Flutter (placa, CNH, formato de e-mail).

---

### **1.5 C√≥digos de Erro**

| C√≥digo | Descri√ß√£o             |
| ------ | --------------------- |
| `0`    | Sem erro              |
| `1`    | CNH inv√°lida          |
| `2`    | Placa inv√°lida        |
| `3`    | CNH e Placa inv√°lidas |

---

## üíª CAMADA 2 ‚Äî FRONTEND (APP FLUTTER)

### **2.1 Estrutura Geral**

* Linguagem: **Dart**
* Framework: **Flutter**
* Padr√£o: **Stateful Widgets**
* Armazenamento local: `SharedPreferences`
* Comunica√ß√£o HTTP: pacote `http`
* Permiss√µes e localiza√ß√£o: `geolocator`, `permission_handler`

---

### **2.2 Principais Telas**

| Tela             | Descri√ß√£o                                                                     |
| ---------------- | ----------------------------------------------------------------------------- |
| **RegisterPage** | Cadastro de motoboys. Inclui valida√ß√£o de CNH, placa e envio de `erroCodigo`. |
| **SettingsPage** | Configura√ß√£o de tarifas e adicionais personalizados.                          |
| **HomePage**     | Tela principal com resumo do status e saldo.                                  |
| **LoginPage**    | Autentica√ß√£o e armazenamento do `idUser` no `SharedPreferences`.              |

---

### **2.3 Classe API (Integra√ß√£o)**

* Local: `lib/api.dart`
* M√©todos:

  * `registerUser()`
  * `saveConfigurations()`
  * `obtemCfgValores()`
  * `saldo()`
  * `heartbeat()`

#### üîπ `registerUser()`

Recebe:

```dart
String nome,
String usuario,
String email,
String senha,
String telefone,
String cnh,
String placa,
String PIX,
int erroCodigo,
int distanciaMaxima
```

Envia JSON √† API `/cadboy` e grava `idUser` localmente.
**Vers√£o do app (`AppConfig.versaoApp`)** inclu√≠da em todas as requisi√ß√µes.

#### üîπ `saveConfigurations()`

Salva valores como:

* `minValue`
* `kmRate`
* `adicionais` (chuva, noite, madrugada, peso)
* `usuario`
* `maxDistance`

---

### **2.4 Componentes e Processos Internos**

#### **Valida√ß√£o de Campos**

* `validarEmail()` ‚Üí Express√£o regular RFC.
* `validarSenha()` ‚Üí M√≠nimo 6 caracteres.
* `validarCNH()` ‚Üí Algoritmo duplo de soma com 2 d√≠gitos verificadores.
* `validarPlaca()` ‚Üí Padr√£o antigo (ABC-1234) e Mercosul (ABC1D23).

#### **Controle de Erros**

* `JaMostrouCnhInv` e `JaMostrouPlaca` controlam se o usu√°rio foi avisado sobre dados inv√°lidos, evitando loops de alerta.
* `deixaPassarCnhInv` permite continuar o cadastro mesmo com erros (apenas se confirmado no di√°logo).

#### **Fluxo do Cadastro**

1. Usu√°rio preenche todos os campos.
2. Sistema valida CNH, placa e e-mail.
3. Caso haja erro e `deixaPassarCnhInv = true`, mostra di√°logo de confirma√ß√£o.
4. Gera `erroCodigo` conforme persist√™ncia de erros.
5. Envia `POST` para `/api/cadboy` com dados JSON.
6. Se `success = true`, armazena `idUser` e vai para `HomePage`.

---

### **2.5 Configura√ß√µes do App**

```dart
class AppConfig {
  static const String versaoApp = "1.1.6";
}
```

A vari√°vel √© usada em todas as chamadas de API para rastrear compatibilidade.

---

## ‚öôÔ∏è CAMADA 3 ‚Äî DETALHES AVAN√áADOS

### **3.1 Processos de Valida√ß√£o**

* CNH ‚Üí algoritmo matem√°tico (soma ponderada).
* Placa ‚Üí `RegExp(r'^[A-Z]{3}-\d{4}$|^[A-Z]{3}\d[A-Z]\d{2}$')`.
* PIX ‚Üí apenas formato livre, sem valida√ß√£o formal.
* Erros controlados via snackbar (`mostrarMensagem(context, mensagem)`).

---

### **3.2 Comunica√ß√£o Ass√≠ncrona**

* Todas as requisi√ß√µes HTTP usam `async/await`.
* Tratamento de exce√ß√µes com `try/catch`.
* Mensagens de erro uniformes em `Map<String, dynamic>` com chaves:
  `success`, `message`.

---

### **3.3 Armazenamento Local**

* `SharedPreferences` guarda:

  * `idUser`
  * `prefer√™ncias de configura√ß√£o`
  * eventuais dados de sess√£o

---

### **3.4 Seguran√ßa**

* Comunica√ß√£o HTTPS.
* Nenhum dado sens√≠vel √© salvo em texto plano al√©m do `idUser`.
* Estrutura preparada para integra√ß√£o futura com `flutter_secure_storage`.

---

### **3.5 Expans√µes Planejadas**

* Integra√ß√£o com Google Login.
* Requisi√ß√µes com token JWT.
* Configura√ß√µes din√¢micas baseadas na geolocaliza√ß√£o do motoboy.
* Logs de eventos de rota.

---

# üî† √çndice Alfab√©tico (Resumo)

| Termo                                | Descri√ß√£o                                                  |
| ------------------------------------ | ---------------------------------------------------------- |
| **AppConfig**                        | Define a vers√£o atual do aplicativo (1.1.6).               |
| **API.registerUser()**               | Envia cadastro para `/api/cadboy`.                         |
| **API.saveConfigurations()**         | Envia configura√ß√µes do motoboy para a API.                 |
| **CNH (valida√ß√£o)**                  | Verifica d√≠gitos e formato da CNH do motoboy.              |
| **deixaPassarCnhInv**                | Permite cadastro mesmo com CNH inv√°lida (com confirma√ß√£o). |
| **erroCodigo**                       | Indica status da CNH/placa: 0‚Äì3.                           |
| **HomePage**                         | Tela inicial ap√≥s login ou cadastro bem-sucedido.          |
| **JaMostrouCnhInv / JaMostrouPlaca** | Evita repeti√ß√£o de alertas.                                |
| **RegisterPage**                     | Tela de cadastro de motoboys.                              |
| **SharedPreferences**                | Armazenamento local do `idUser` e prefer√™ncias.            |
| **versaoApp**                        | Vers√£o atual do app, enviada ao servidor.                  |

---

Deseja que eu gere este documento em **formato `.pdf`** ou **`.docx`** para uso interno na equipe?
