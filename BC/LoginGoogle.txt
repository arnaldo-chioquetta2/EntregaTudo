Perfeito ‚úÖ
Abaixo est√° o **Documento Base de Conhecimento do Projeto EntregaTudo**, totalmente estruturado conforme o modelo que voc√™ pediu ‚Äî primeiro superficial, depois aprofundado, e com ordena√ß√£o final alfab√©tica dentro de cada camada.

---

# üìò Documento Base de Conhecimento ‚Äî Projeto **EntregaTudo**

---

## 1Ô∏è‚É£ VIS√ÉO GERAL (Camada Superficial)

### 1.1 Prop√≥sito

O **EntregaTudo** √© um sistema completo de gest√£o de entregas e log√≠stica voltado para **motoboys** e **entregadoras parceiras**.
Ele integra **aplicativo Flutter**, **API Laravel/PHP** e **painel administrativo web**, permitindo:

* Cadastro e autentica√ß√£o de entregadores (motoboys);
* Recebimento de pedidos vindos de e-commerces;
* Acompanhamento em tempo real via GPS;
* Controle de saldo e hist√≥rico de entregas;
* Comunica√ß√£o via WhatsApp com clientes e empresas.

---

## 2Ô∏è‚É£ BACKEND (Camada T√©cnica)

### 2.1 Linguagem e Estrutura

* Linguagem principal: **PHP (Laravel)**
* Localiza√ß√£o: Servidor TeleTudo
* Estrutura de API REST com endpoints p√∫blicos e internos.
* Todas as requisi√ß√µes usam `JSON` e comunica√ß√£o via `HTTP POST`.

---

### 2.2 Principais Endpoints

| Endpoint                 | Fun√ß√£o                                  | Observa√ß√µes                                                         |
| ------------------------ | --------------------------------------- | ------------------------------------------------------------------- |
| `/api/login`             | Autentica motoboy                       | Retorna dados do usu√°rio e token de sess√£o                          |
| `/api/cadboy`            | Cadastra novo motoboy                   | Campos: `nome_completo`, `email`, `telefone`, `cnh`, `placa`, `pix` |
| `/api/saldo`             | Consulta saldo atual                    | Baseado no ID do usu√°rio                                            |
| `/api/respondToDelivery` | Aceite ou recusa de entrega             | Recebe `userId`, `deliveryId`, `accept`                             |
| `/api/heartbeat`         | Atualiza geolocaliza√ß√£o                 | Executado a cada 30 segundos pelo app                               |
| `/api/orcamento`         | Calcula valor de entrega                | Usa coordenadas e dist√¢ncia m√°xima do entregador                    |
| `/api/updateTime`        | Atualiza tempo de visualiza√ß√£o de v√≠deo | Usado no sistema VOD interno                                        |

---

### 2.3 Principais Tabelas

* `et_entregador` ‚Äî cont√©m dados do motoboy ativo, inclusive `distancia_maxima`
* `tt_entregador` ‚Äî dados gen√©ricos de entregadores de outras empresas
* `tt_pedidos` ‚Äî pedidos criados e associados a entregas
* `tt_logs_entregas` ‚Äî log hist√≥rico de eventos por entrega
* `tt_entregadoras` ‚Äî cadastro das empresas entregadoras
* `tt_imagem` ‚Äî imagens de produtos e banners, com campo `tam` (filtrado <1000 ou !=21773)

---

### 2.4 Processos Internos

**1. Cadastro (`cadboy`)**
Recebe os dados, faz split de DDD e telefone, valida campos obrigat√≥rios e grava no `et_entregador`.

**2. Heartbeat**
Recebe `userid`, `lat`, `lon`, e armazena status ativo do motoboy.

**3. Orcamento**

* Calcula a rota entre cliente e fornecedor;
* Define o entregador ideal com base em dist√¢ncia e disponibilidade;
* Grava log com ‚ÄúModo teste ativado‚Äù se `Modo = 1`.

**4. Resposta de Entrega (`respondToDelivery`)**
Atualiza status de aceite ou recusa diretamente no sistema de entregas.

**5. Imagens no Carrossel**
O m√©todo `getCarrossel()` traz produtos e imagens, evitando duplicatas e removendo tamanhos inv√°lidos.

---

## 3Ô∏è‚É£ FRONTEND (Camada do App Flutter)

### 3.1 Estrutura

**Caminho do projeto Flutter:**
`D:\Prog\entregatudo\`

**Principais pastas:**

* `lib/` ‚Äî c√≥digo-fonte Dart
* `android/` ‚Äî configura√ß√£o Gradle e Manifest
* `build/` ‚Äî sa√≠da de builds
* `assets/` ‚Äî √≠cones e imagens
* `pubspec.yaml` ‚Äî depend√™ncias do projeto

---

### 3.2 Depend√™ncias (Principais)

| Biblioteca               | Fun√ß√£o                                |
| ------------------------ | ------------------------------------- |
| `http`                   | Comunica√ß√£o com API Laravel           |
| `shared_preferences`     | Armazenamento leve de dados locais    |
| `flutter_secure_storage` | Guardar login e senha de forma segura |
| `permission_handler`     | Permiss√µes (localiza√ß√£o, GPS)         |
| `geolocator`             | Captura de coordenadas em tempo real  |
| `url_launcher`           | Abertura de links (WhatsApp, etc.)    |
| `font_awesome_flutter`   | √çcones personalizados no app          |

---

### 3.3 Telas e Fluxos Principais

#### üì± Login (`lib/login_page.dart`)

* Campos de usu√°rio e senha;
* ‚ÄúOlho‚Äù para mostrar/ocultar senha (`_obscurePassword`);
* Checkbox ‚ÄúLembrar senha‚Äù (usando `flutter_secure_storage`);
* Login via `API.veLogin()`;
* Ap√≥s sucesso ‚Üí redireciona para `HomePage`.

#### üè† Home (`lib/home_page.dart`)

* Exibe saldo e status do motoboy;
* Mostra bot√µes ‚ÄúCheguei‚Äù, ‚ÄúRetirado‚Äù, ‚ÄúEntregue‚Äù;
* Inclui op√ß√£o de logout (limpa credenciais seguras).

#### üß≠ Localiza√ß√£o

* Usa `geolocator` com `permission_handler`;
* Atualiza posi√ß√£o com `API.heartbeat()`.

#### üí¨ WhatsApp Invite

* Chama `url_launcher` para abrir link `https://wa.me/?text=...`;
* Caso falhe, exibe mensagem ‚ÄúN√£o foi poss√≠vel abrir o WhatsApp‚Äù.

---

### 3.4 M√©todos Internos (App)

| M√©todo                                 | Local                        | Descri√ß√£o                             |
| -------------------------------------- | ---------------------------- | ------------------------------------- |
| `API.veLogin()`                        | `lib/api.dart`               | Envia login ao backend                |
| `API.respondToDelivery()`              | `lib/api.dart`               | Aceita/recusa entrega                 |
| `API.saldo()`                          | `lib/api.dart`               | Obt√©m saldo via GET/POST              |
| `updateSaldo()`                        | `lib/home_page.dart`         | Atualiza interface de saldo           |
| `updateVodWatchingTime()`              | `lib/playback_activity.dart` | Envia tempo de v√≠deo assistido        |
| `_loadSavedCredentials()`              | `lib/login_page.dart`        | L√™ usu√°rio/senha salvos com seguran√ßa |
| `_storage.write()` / `_storage.read()` | `flutter_secure_storage`     | Persist√™ncia segura local             |

---

## 4Ô∏è‚É£ INFRAESTRUTURA E BUILD (Camada Profunda)

### 4.1 Compila√ß√£o Autom√°tica (Windows)

**Arquivo:**
`D:\Prog\entregatudo\compila.bat`

Executa:

1. `flutter clean`
2. `flutter pub get`
3. `gradlew clean`
4. `flutter build apk --release --no-tree-shake-icons`
5. Renomeia para `EntregaTudo.apk`
6. Chama `upa.bat`

---

### 4.2 Upload Autom√°tico

**Arquivo:**
`D:\Prog\entregatudo\upa.bat`

Executa:

1. Copia `EntregaTudo.apk` para
   `D:\Prog\TeleTudo\public_html\public\download`
2. Substitui o arquivo existente
3. Chama `D:\Prog\FTPc3\bin\Release\FTPc.exe`

---

### 4.3 Manifest e Permiss√µes

**Arquivo:**
`D:\Prog\entregatudo\android\app\src\main\AndroidManifest.xml`

Permiss√µes usadas:

```xml
<uses-permission android:name="android.permission.INTERNET"/>
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION"/>
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION"/>
<uses-permission android:name="android.permission.ACCESS_BACKGROUND_LOCATION"/>
```

---

## 5Ô∏è‚É£ ORDENADO (Alfab√©tico Resumido)

| Termo                  | Descri√ß√£o                              |
| ---------------------- | -------------------------------------- |
| API.veLogin            | Valida√ß√£o de login via POST            |
| APK                    | Arquivo de aplicativo Android          |
| cadboy                 | Endpoint de cadastro de motoboy        |
| compila.bat            | Script de build Flutter                |
| et_entregador          | Tabela principal de motoboys           |
| flutter_secure_storage | Armazena login/credencial segura       |
| geolocator             | Biblioteca para GPS                    |
| heartbeat              | Atualiza√ß√£o peri√≥dica da posi√ß√£o       |
| login_page.dart        | Tela principal de autentica√ß√£o         |
| orcamento              | Fun√ß√£o que calcula custo de entrega    |
| respondToDelivery      | Endpoint para aceitar/recusar entregas |
| saldo                  | Consulta saldo do motoboy              |
| TeleTudo               | Servidor e dom√≠nio principal           |
| upa.bat                | Script que copia APK e envia via FTP   |

---

Quer que eu gere este documento em formato **.docx ou .pdf** para guardar como refer√™ncia no seu diret√≥rio `D:\Prog\entregatudo\docs`?
